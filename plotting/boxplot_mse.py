import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns


sub003 = {

    'Walk': [[0.03824047, 0.03750414, 0.08246341, 0.06979081, 0.01024385, 0.00904145],
             [0.04622059, 0.04328938, 0.08756634, 0.07337411, 0.00931223, 0.01180927],
             [0.04067174, 0.03559867, 0.0849535, 0.06368898, 0.00894854, 0.00990128],
             [0.04844231, 0.0442358, 0.09284973, 0.0820682, 0.01033806, 0.01232667],
             [0.03544044, 0.03354587, 0.08385935, 0.06922361, 0.0095645, 0.0099784, ]],

    'UpSit': [[np.nan] * 6] * 5,

    'DownSit': [[np.nan] * 6] * 5,

    'UpStair': [[0.04090756, 0.03609553, 0.06364323, 0.0471705, 0.00708903, 0.00611331],
                [0.00816694, 0.00680676, 0.01561671, 0.01571266, 0.00642988, 0.0039879, ],
                [0.00847696, 0.00884829, 0.01806834, 0.0104678, 0.00476234, 0.00733719],
                [0.01061871, 0.00996073, 0.01674124, 0.01890416, 0.00436376, 0.00685697],
                [0.01540011, 0.01567517, 0.02520664, 0.03188578, 0.00799543, 0.00495974]],

    'DownStair': [[0.00612285, 0.00578358, 0.01879047, 0.0167841, 0.00663417, 0.00836469],
                  [0.00438188, 0.00476738, 0.00907062, 0.0064577, 0.00525189, 0.00447944],
                  [0.003742, 0.00389053, 0.00871678, 0.00640825, 0.00382017, 0.00413646],
                  [0.00512312, 0.00430478, 0.00735786, 0.00817203, 0.00359931, 0.00481318],
                  [0.00357946, 0.00383798, 0.00794837, 0.00757935, 0.00439191, 0.00319906]],

}

sub004 = {

    'Walk': [[0.00377205, 0.00465626, 0.01094699, 0.01162657, 0.00358774, 0.0025468, ],
             [0.00341345, 0.001967, 0.00515578, 0.00472162, 0.00336153, 0.00234415],
             [0.00463895, 0.00541641, 0.00712215, 0.00825748, 0.00467005, 0.00223233],
             [0.0027139, 0.00191933, 0.00426567, 0.00386409, 0.00284691, 0.00183728],
             [0.00335452, 0.00197941, 0.00447888, 0.00317816, 0.00375527, 0.00223147]],

    'UpSit': [[0.00628776, 0.00484458, 0.01049703, 0.01043303, 0.0012079, 0.00151943],
              [0.00745156, 0.00733318, 0.00205705, 0.00245929, 0.00050634, 0.00052291],
              [0.00138817, 0.0019304, 0.00064357, 0.00162243, 0.00015416, 0.00011331],
              [0.00336169, 0.00331541, 0.00138585, 0.00162935, 0.0023162, 0.00152753],
              [0.00243761, 0.00161425, 0.00122903, 0.00090572, 0.00135736, 0.00085692]],

    'DownSit': [[0.03265781, 0.02718955, 0.05293511, 0.0440466, 0.00112849, 0.0010903, ],
                [0.00794234, 0.00760706, 0.00611316, 0.0039883, 0.00040253, 0.00061031],
                [0.00191507, 0.00237905, 0.00161219, 0.00158802, 0.00137725, 0.00124005],
                [0.00188506, 0.00198715, 0.003624, 0.00335502, 0.00094038, 0.00054417],
                [0.00158084, 0.00114996, 0.0008129, 0.00098862, 0.00054974, 0.00030252]],

    'UpStair': [[0.02702293, 0.01238432, 0.05793493, 0.02097531, 0.00920536, 0.00567599],
                [0.00761944, 0.00729028, 0.01243473, 0.01036744, 0.00671177, 0.00744563],
                [0.00721072, 0.00900726, 0.01562757, 0.01221092, 0.00737731, 0.00809198],
                [0.01187667, 0.00971359, 0.03649135, 0.01644723, 0.00924944, 0.00430274],
                [0.01008023, 0.00572763, 0.01553905, 0.01136361, 0.00505791, 0.0042259, ]],

    'DownStair': [[0.01965069, 0.01234065, 0.06987657, 0.04913597, 0.02395688, 0.02751718],
                  [0.0058031, 0.00512274, 0.01054756, 0.01030167, 0.00833327, 0.00805274],
                  [0.01013403, 0.00686115, 0.02809582, 0.04103134, 0.02113456, 0.01335607],
                  [0.01154388, 0.0048183, 0.03250058, 0.03359115, 0.0180308, 0.01478238],
                  [0.00893851, 0.00512368, 0.01187836, 0.01187483, 0.00849092, 0.0052912, ]],
}

sub005 = {

    'Walk': [[0.003024, 0.00435936, 0.00655024, 0.00696246, 0.00303968, 0.00277856],
             [0.00207936, 0.00193588, 0.00366732, 0.0028623, 0.00244992, 0.00243315],
             [0.00308967, 0.00219315, 0.00468562, 0.00422014, 0.00353044, 0.00282847],
             [0.00198934, 0.00207114, 0.00341487, 0.00353453, 0.00278109, 0.00284328],
             [0.0015025, 0.0017024, 0.00420537, 0.00319895, 0.00313244, 0.00237474]],

    'UpSit': [[3.65225743e-03, 4.12320176e-03, 1.63870391e-03, 9.26931052e-04, 2.36149841e-03, 4.32262259e-04],
              [2.36058499e-04, 6.47126398e-04, 4.17220852e-04, 3.58988246e-04, 3.76392083e-04, 1.95147566e-04],
              [1.44604154e-03, 7.49336598e-04, 5.95727942e-04, 2.51191063e-04, 1.40266697e-03, 6.30183716e-05],
              [1.01310146e-03, 8.49520463e-04, 8.02588818e-04, 5.07491425e-04, 3.56654349e-03, 1.83742948e-04],
              [6.25514815e-04, 5.88843791e-04, 1.74298585e-03, 1.99175544e-03, 5.68881334e-04, 2.32547777e-04]],

    'DownSit': [[0.02523943, 0.02581139, 0.07154302, 0.07823711, 0.00244904, 0.00318734],
                [0.01033093, 0.00962414, 0.00851331, 0.00992924, 0.00170271, 0.00116547],
                [0.00737556, 0.00467745, 0.00234914, 0.00253535, 0.00201832, 0.00394853],
                [0.00379484, 0.00480781, 0.00201402, 0.00188833, 0.00020566, 0.00054159],
                [0.00176834, 0.0014558, 0.00112626, 0.00155365, 0.00171583, 0.0033729, ]],

    'UpStair': [[0.01103774, 0.02955074, 0.02569381, 0.07276993, 0.00663944, 0.00763168],
                [0.02122242, 0.02284901, 0.04082425, 0.03859227, 0.01169975, 0.01181734],
                [0.01359369, 0.01561221, 0.03043517, 0.02150958, 0.00505812, 0.00557716],
                [0.00694127, 0.00681759, 0.00920429, 0.01216997, 0.0059557, 0.00583931],
                [0.00726045, 0.00737328, 0.01461393, 0.01761682, 0.00696492, 0.00694597]],

    'DownStair': [[0.012194, 0.01327067, 0.05758146, 0.06658108, 0.02369472, 0.03151688],
                  [0.00544164, 0.00541431, 0.03051217, 0.02838552, 0.0110214, 0.01586588],
                  [0.01052282, 0.0098968, 0.05354298, 0.05593883, 0.01606225, 0.01708382],
                  [0.01241956, 0.00793893, 0.05535479, 0.03207982, 0.01488297, 0.01709543],
                  [0.00267666, 0.00561163, 0.00869866, 0.01253206, 0.00697307, 0.00581191]]

}

sub101 = {

    'Walk': [[0.01162048, 0.01063403, 0.01598974, 0.01212947, 0.00482114, 0.004558, ],
             [0.01025371, 0.00938429, 0.01334228, 0.011311, 0.00488862, 0.00400051],
             [0.00819637, 0.00732918, 0.01432819, 0.00767854, 0.00511529, 0.00539798],
             [0.00664732, 0.0055778, 0.00692762, 0.00535608, 0.00369732, 0.00351899],
             [0.00436186, 0.00458868, 0.00530974, 0.00693869, 0.00366657, 0.00334663]],

    'UpSit': [[0.00831754, 0.00689136, 0.0062401, 0.0072711, 0.00055412, 0.00089381],
              [0.00455959, 0.00371747, 0.00479192, 0.00438423, 0.00145076, 0.00132449],
              [0.00383226, 0.00366247, 0.00149026, 0.00136087, 0.0003985, 0.00053274],
              [0.00344879, 0.00350203, 0.00102249, 0.00208968, 0.00042236, 0.00074479],
              [0.00359561, 0.00342279, 0.00182967, 0.0019461, 0.00056539, 0.00052617]],

    'DownSit': [[0.01710422, 0.01500396, 0.01713224, 0.01651832, 0.00052486, 0.00089613],
                [0.00628144, 0.00550209, 0.00278137, 0.00287925, 0.00094603, 0.00116864],
                [0.01323945, 0.01207687, 0.01444241, 0.01391112, 0.00074778, 0.00064653],
                [0.00462079, 0.00390459, 0.00390427, 0.00343346, 0.0005551, 0.00033796],
                [0.00738394, 0.0060067, 0.00732996, 0.00611638, 0.00165826, 0.00129207]],

    'UpStair': [[0.04582556, 0.02693632, 0.07234543, 0.02948365, 0.01288116, 0.01631057],
                [0.02273511, 0.03053764, 0.03388514, 0.03505911, 0.00870345, 0.01192595],
                [0.01148414, 0.00728119, 0.01486525, 0.01347534, 0.0057252, 0.00552697],
                [0.01658291, 0.01184804, 0.01943825, 0.01689262, 0.00820139, 0.00776699],
                [0.01782174, 0.01539931, 0.02937983, 0.01614436, 0.00715564, 0.0086595, ]],

    'DownStair': [[0.01592271, 0.01481841, 0.07029801, 0.05584937, 0.0184746, 0.02313286],
                  [0.01358665, 0.01328357, 0.07465548, 0.04911788, 0.02005104, 0.02388994],
                  [0.00961679, 0.00832454, 0.03055189, 0.01841654, 0.01034638, 0.01222817],
                  [0.01208536, 0.01255807, 0.06371618, 0.04806822, 0.016062, 0.01834436],
                  [0.00671976, 0.00919426, 0.01857746, 0.01956618, 0.0087953, 0.01203783]],

}

sub102 = {

    'Walk': [[0.0086557, 0.00834645, 0.02079585, 0.0178551, 0.00850985, 0.00727924],
             [0.00937885, 0.00715713, 0.01993854, 0.01678159, 0.00804061, 0.00674483],
             [0.00841615, 0.00686714, 0.01894382, 0.01645954, 0.00806501, 0.00727123],
             [0.00852207, 0.00574504, 0.01533973, 0.01801085, 0.00838525, 0.00844867],
             [0.0073049, 0.00624814, 0.0135626, 0.01746318, 0.00600711, 0.00696873]],

    'UpSit': [[0.03628987, 0.03405501, 0.0512511, 0.05183122, 0.00245985, 0.00302183],
              [0.01489362, 0.01399215, 0.00570698, 0.00660861, 0.0009693, 0.00122843],
              [0.01549152, 0.01511954, 0.00895138, 0.00938749, 0.00093682, 0.00144694],
              [0.01025768, 0.01002369, 0.00646479, 0.00644818, 0.00221151, 0.00278421],
              [0.01452214, 0.01316163, 0.01148861, 0.01006495, 0.00126321, 0.00086099]],

    'DownSit': [[0.03034175, 0.02959759, 0.05209477, 0.05090614, 0.00267846, 0.00235225],
                [0.01153828, 0.01140404, 0.00975582, 0.01086276, 0.00175629, 0.00183158],
                [0.0078741, 0.00742404, 0.00747399, 0.00589228, 0.00235121, 0.00368876],
                [0.00985044, 0.00898851, 0.00569489, 0.00621807, 0.00230935, 0.00297258],
                [0.00802222, 0.006999, 0.00354897, 0.00279458, 0.00138714, 0.00097802]],

    'UpStair': [[0.03725865, 0.0253506, 0.06806638, 0.05884468, 0.01308979, 0.01222179],
                [0.03521279, 0.02061077, 0.06788242, 0.05027847, 0.01145706, 0.01139998],
                [0.02977616, 0.01757856, 0.04662046, 0.04759241, 0.00946612, 0.00582421],
                [0.00708702, 0.00744575, 0.01257736, 0.01660949, 0.00553709, 0.0063292, ],
                [0.00938769, 0.00676393, 0.01675786, 0.0118175, 0.00517525, 0.00618933]],

    'DownStair': [[0.01991764, 0.01996092, 0.09285581, 0.10542147, 0.04208731, 0.03636144],
                  [0.00480147, 0.00723732, 0.01726771, 0.01936986, 0.01069293, 0.01288482],
                  [0.0047665, 0.00703876, 0.02406363, 0.01585239, 0.01400067, 0.01507992],
                  [0.00454577, 0.00678007, 0.0170226, 0.01815491, 0.01344398, 0.0133511, ],
                  [0.00513524, 0.00734154, 0.01551047, 0.02178066, 0.0118404, 0.01434926]],

}

sns.set_style('darkgrid')
sns.set_context('talk')
fig, ax = plt.subplots(1, 5, figsize=(16, 4.5), sharey='all')

taskdict = {

    'Walk': [],

    'UpSit': [],

    'DownSit': [],

    'UpStair': [],

    'DownStair': []

}
def p(a):
    a = np.array(a)
    b = np.zeros((a.shape[0], 3))
    for it in range(3):
        b[:, it] = (a[:, it * 2] + a[:, it * 2 + 1]) / 2
    return b

ye = []
for i, s in enumerate([sub003, sub004, sub005, sub101, sub102]):
    for key in s.keys():
        taskdict[key].append(np.mean(p(s[key]), axis=0))
for key in taskdict.keys():
    taskdict[key] = np.vstack(taskdict[key])
for key in taskdict.keys():
    print(np.mean(taskdict[key][~np.isnan(taskdict[key][:, 0]) * ~np.isnan(taskdict[key][:, 2]), :], axis=0))
    ye.append(np.mean(taskdict[key][~np.isnan(taskdict[key][:, 0]) * ~np.isnan(taskdict[key][:, 2]), :], axis=0))

for i, s in enumerate([sub003, sub004, sub005, sub101, sub102]):
    sub = np.sqrt(np.array([p(cur_task) for cur_task in s.values()]).T)/np.pi*180
    sub = sub.reshape((-1, 5)).T.flatten()
    dfs = pd.DataFrame(sub, columns=['$R^2$'])
    dfs['Angle'] = np.tile(np.repeat(['Hip', 'Knee', 'Ankle'], 5), 5)
    dfs['task'] = np.repeat(['Walk', 'Stand up', 'Sit Down', 'Ascend', 'Descend'], 15)
    print(dfs)
    ch = sns.barplot(ax=ax[i], data=dfs, y='$R^2$', x='task', hue='Angle')
    ch.set_xticklabels(ch.get_xticklabels(), rotation=60)
    ch.set_title('Subject ' + str(i + 1))
    ax[i].set_xlabel('')
    ax[i].get_legend().remove()
    if i == 0:
        ch.set_ylabel('Validation RMSE (°)')
    else:
        ax[i].set_ylabel('')
    if i == 1:
        ax[i].legend()
plt.tight_layout()
plt.show()